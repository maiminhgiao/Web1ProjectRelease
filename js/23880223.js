const API="https://web1-api.vercel.app/api",AUTHENTICATE_API="https://web1-api.vercel.app/users";async function loadData(request,templateId,viewId){const response=await fetch(`${API}/${request}`),data=await response.json();var templateName=templateId.replace("#",""),template=Handlebars.templates[`${templateName}.hbs`],context={data:data},view;document.getElementById(viewId).innerHTML=template(context)}async function getAuthenticateToken(username,password){const response=await fetch(`${AUTHENTICATE_API}/authenticate`,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({username:username,password:password})}),result=await response.json();if(200===response.status)return result;throw new Error(result.message||"Authentication failed")}async function login(e){e.preventDefault();const username=document.getElementById("username").value,password=document.getElementById("password").value;try{const token=await getAuthenticateToken(username,password);if(token&&token.token){localStorage.setItem("authToken",token.token);const modalEl=document.getElementById("modalLogin"),modal=bootstrap.Modal.getInstance(modalEl);document.activeElement.blur(),modal&&modal.hide(),displayControls(!0)}}catch(error){document.getElementById("errorMessage").innerHTML=error.message||"Login failed",displayControls(!1)}}function displayControls(isLoggedIn=!1){const linkLogins=document.getElementsByClassName("linkLogin"),linkLogouts=document.getElementsByClassName("linkLogout"),displayLogin=isLoggedIn?"none":"block",displayLogout=isLoggedIn?"block":"none";for(let i=0;i<linkLogins.length;i++)linkLogins[i].style.display=displayLogin;for(let i=0;i<linkLogouts.length;i++)linkLogouts[i].style.display=displayLogout;const leaveComment=document.getElementById("leave-comment");leaveComment&&(leaveComment.style.display=displayLogout)}async function checkLogin(){let isLogin;displayControls(await verifyToken())}async function verifyToken(){let token=localStorage.getItem("authToken");if(token){let response;if(200===(await fetch(`${AUTHENTICATE_API}/verify`,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json",Authorization:"Bearer "+token}})).status)return!0}return!1}function logout(){localStorage.clear(),displayControls(!1)}function updateLoginStatus(){const token=localStorage.getItem("token"),linkLogin=document.querySelectorAll(".linkLogin"),linkLogout=document.querySelectorAll(".linkLogout");token?(linkLogin.forEach(el=>el.style.display="none"),linkLogout.forEach(el=>el.style.display="block")):(linkLogin.forEach(el=>el.style.display="block"),linkLogout.forEach(el=>el.style.display="none"))}async function initLoginState(){const isLogin="true"===localStorage.getItem("isLogin");displayControls(isLogin);const valid=await verifyToken();valid||logout()}